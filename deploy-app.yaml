trigger:
- master

pool:
  name: Bharath-Finance-Pool
  vmImage: 'macOS-latest' # Use macOS or another suitable image for Android development

variables:
  JAVA_HOME: $(JAVA_HOME_8_X64)
  JAVA_HOME_8_X64: /usr/lib/jvm/java-8-openjdk-amd64
  ANDROID_SDK_ROOT: /opt/android-sdk 

steps:
- script: |
    chmod +x ./gradlew
    ./gradlew assembleRelease
  displayName: 'Build Android App'

# - task: CopyFiles@2
#   inputs:
#     sourceFolder: '$(Build.SourcesDirectory)/app/build/outputs/apk/release/'
#     contents: '**/*.apk'
#     targetFolder: '$(Build.ArtifactStagingDirectory)'

# - task: PublishPipelineArtifact@1
#   inputs:
#     targetPath: '$(Build.ArtifactStagingDirectory)'
#     artifactName: 'apk'

- script: |
    echo '$(Build.SourcesDirectory)'
  displayName: Source Directory Path


- task: CopyFiles@2
  inputs:
    SourceFolder: '$(agent.builddirectory)'
    Contents: '**/*.apk'
    TargetFolder: '$(Build.ArtifactStagingDirectory)'
    OverWrite: true


- task: PublishPipelineArtifact@1
  inputs:
    targetPath: '$(Build.ArtifactStagingDirectory)'
    artifactName: 'apk'

- script: |
    ls -R '$(Build.ArtifactStagingDirectory)'
  displayName: List Artifact Staging Directory Contents

    
- task: AppCenterDistribute@3
  inputs:
    serverEndpoint: 'app-center'
    appSlug: 'Bharath-Finance-poc_apk'
    appFile: '$(Pipeline.Workspace)/drop/**/*.apk'
    symbolsOption: 'Android'
    releaseNotesOption: 'input'
    releaseNotesInput: 'Release notes for this version.'
    destinationType: 'groups'
